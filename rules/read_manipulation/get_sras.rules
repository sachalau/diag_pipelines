rule download_sra_paired_from_ENA:
    output:
        R1=temp("reads/ENA/{sample,[A-Za-z0-9]+}_1.fastq.gz"),
        R2=temp("reads/ENA/{sample,[A-Za-z0-9]+}_2.fastq.gz"),
    log:
        "logs/samples/{sample}/sras/dump.txt"
    shell:
        """
        R1=$(wget -qO- "http://www.ebi.ac.uk/ena/data/warehouse/filereport?accession={wildcards.sample}&result=read_run&fields=fastq_ftp" | tail -n 1 | cut -f1 -d';')
        R2=$(wget -qO- "http://www.ebi.ac.uk/ena/data/warehouse/filereport?accession={wildcards.sample}&result=read_run&fields=fastq_ftp" | tail -n 1 | cut -f2 -d';')
        wget -qO- ftp://$R1 > {output[R1]}
        sleep 5s
        wget -qO- ftp://$R2 > {output[R2]}
        """




rule download_sra_paired_from_SRA:
    conda:
        pipeline_path + "envs/sra-tools.yml"
    output:
        R1=temp("reads/SRA/{sample,[A-Za-z0-9]+}_1.fastq"),
        R2=temp("reads/SRA/{sample,[A-Za-z0-9]+}_2.fastq"),
    log:
        "logs/samples/{sample}/sras/dump.txt"
    shell:
        """
        vdb-config --report-cloud-identity yes
        fasterq-dump --split-files --outdir $(dirname {output[0]}) --log-level 0 --min-read-len 0 {wildcards.sample}
        """
